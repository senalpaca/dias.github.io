---
layout: layouts/base.njk
title: "Documents and Data"
lang: "en"
dir: "ltr"
---

<main class="case-page">

  <!-- HEADER -->
  <div class="case-page__header">

    <!-- LEFT SIDE -->
    <div class="case-page__title">
      <h1>{{ title }}</h1>

      {% if case_id or date_range or location %}
        <div class="case-meta">
          {% if case_id %}
            <span><strong>ID:</strong> {{ case_id }}</span>
          {% endif %}
          {% if date_range %}
            <span><strong>Period:</strong> {{ date_range }}</span>
          {% endif %}
          {% if location %}
            <span><strong>Location:</strong> {{ location }}</span>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- RIGHT SIDE -->
    {#
    {% if translations %}
      <div class="lang-switcher">
        {% for code, url in translations %}
          <a
            href="{{ url }}"
            class="lang-switcher__link{% if code == lang %} lang-switcher__link--active{% endif %}">
            {% if code == "ar" %}العربية{% else %}{{ code | upper }}{% endif %}
          </a>
        {% endfor %}
      </div>
    {% endif %}
    #}
  </div>

  <!-- SEARCH -->
  <input
    type="text"
    id="table-search"
    class="case-page__search"
    placeholder="Search"
  >

  <!-- FILTER BAR (added) -->
    <div class="docs-filter-row">
    <!-- Left: Filter form -->
    <div class="docs-filter-wrapper">
      <div class="docs-filter" id="docsFilter">
        <form class="docs-filter__form" onsubmit="return false;">
          <fieldset class="docs-filter__group" aria-label="Type">
            <label><input type="checkbox" name="type" value="document" checked>Independent Resources</label>
            <label><input type="checkbox" name="type" value="document" checked>Inquiry</label>
            <label><input type="checkbox" name="type" value="media" checked>Internal Guidelines</label>
            <label><input type="checkbox" name="type" value="legal" checked>PR</label>
          </fieldset>

          <div class="docs-filter__meta">
            <span id="docsCount" aria-live="polite">
              {% if documents and documents.en %}Found {{ documents.en | length }} item(s).{% else %}Found 0 item(s).{% endif %}
            </span>
            <noscript><em>(Enable JavaScript to filter.)</em></noscript>
          </div>
        </form>
      </div>
    </div>

    <!-- Right: Reset button -->
    <div class="docs-filter-reset">
      <button id="resetFilterBtn" class="btn btn-outline">Reset Filter</button>
    </div>
  </div>

  <!-- TABLE (kept) -->
  <div class="case-page__table">
    <table class="table searchable-table searchable-table-reports">
      <tbody id="docsTableBody">

        {# ——— real rows from data ——— #}
        {% for d in documents.en %}
          {% set t = (d.type or 'document') | lower %}
          {% set y = d.year or '' %}
          {% set tagsList = d.tags or [] %}
          {% set tags = tagsList | join(', ') %}

          <tr
            class="doc-row"
            data-type="{{ (d.type or 'document') | lower }}"
            data-tags="{{ (d.tags or []) | join(' ') | lower }}"
            data-year="{{ d.year }}"
            data-title="{{ (d.title or '') | lower }}"
          >
            <td data-label="Title">
              <a class="view-doc"
                 href="/en/documents/{{ d.slug }}/"
                 data-view="/en/documents/{{ d.slug }}/"
                 aria-label="Open {{ d.title }}">
                <picture>
                  {% if d.thumb %}
                    <img src="{{ d.thumb }}" alt="{{ d.title }}">
                  {% else %}
                    <img src="/assets/thumbs/pdf-placeholder.png" alt="PDF" />
                  {% endif %}
                </picture>
                <h4>{{ d.title }}</h4>
              </a>
            </td>

            <td data-label="Date / Year">
              {{ d.displayDate or y }}
            </td>

            <td data-label="Tags">
              {% for tg in tagsList %}
                <a class="chip" href="?tag={{ tg | url }}">{{ tg }}</a>
              {% endfor %}
            </td>

            <td data-label="Open">
              <a
                class="btn btn-filled-positive view-doc"
                href="/en/documents/{{ d.slug }}/"
                data-view="/en/documents/{{ d.slug }}/"
                aria-label="Open {{ d.title }} in viewer">
                View
              </a>
              {% if d.pdf %}
              <a
                class="btn download"
                href="{{ d.pdf }}"
                aria-label="Download {{ d.title }}">
                Download
              </a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}

        {# ——— (optional) keep any static content rows you render via {{ content | safe }} ——— #}
        {{ content | safe }}
      </tbody>
    </table>

    <!-- Empty state -->
    <p id="docsEmpty" style="display:none; opacity:.8; margin-top:1rem;">
      No documents match the current filters.
    </p>
  </div>

</main>

{# === Inline viewer modal (opens the existing PDF viewer page in an iframe) === #}
<div id="docModal" class="doc-modal" hidden>
  <div class="doc-modal__backdrop" data-close></div>
  <div class="doc-modal__dialog" role="dialog" aria-modal="true" aria-label="Document viewer">
    <button class="doc-modal__close" type="button" data-close aria-label="Close viewer">×</button>
    <iframe id="docFrame" class="doc-modal__frame" src="about:blank" allow="fullscreen"></iframe>
  </div>
</div>

<script src="/assets/scripts/docs-filter.js" defer></script>
