{% set currentLang = lang or "en" %}

{# Determine text direction: explicit dir > arabic default > ltr #}
{% if dir %}
  {% set currentDir = dir %}
{% elseif currentLang == "ar" %}
  {% set currentDir = "rtl" %}
{% else %}
  {% set currentDir = "ltr" %}
{% endif %}

{# ---------- Path-preserving language switcher (with double-strip) ---------- #}
{% set currentPath = page.url or '/' %}
{% set restPath = currentPath %}

{# Pass 1: strip one leading /en or /de or /ar (with/without trailing slash) #}
{% if restPath | slice(0,4) == '/en/' %}
  {% set restPath = restPath | replace('/en/', '/') %}
{% elseif restPath | slice(0,3) == '/en' %}
  {% set restPath = restPath | replace('/en', '/') %}
{% elseif restPath | slice(0,4) == '/de/' %}
  {% set restPath = restPath | replace('/de/', '/') %}
{% elseif restPath | slice(0,3) == '/de' %}
  {% set restPath = restPath | replace('/de', '/') %}
{% elseif restPath | slice(0,4) == '/ar/' %}
  {% set restPath = restPath | replace('/ar/', '/') %}
{% elseif restPath | slice(0,3) == '/ar' %}
  {% set restPath = restPath | replace('/ar', '/') %}
{% endif %}

{# Pass 2: strip again (cleans cases like /de/ar/about/ -> /about/) #}
{% if restPath | slice(0,4) == '/en/' %}
  {% set restPath = restPath | replace('/en/', '/') %}
{% elseif restPath | slice(0,3) == '/en' %}
  {% set restPath = restPath | replace('/en', '/') %}
{% elseif restPath | slice(0,4) == '/de/' %}
  {% set restPath = restPath | replace('/de/', '/') %}
{% elseif restPath | slice(0,3) == '/de' %}
  {% set restPath = restPath | replace('/de', '/') %}
{% elseif restPath | slice(0,4) == '/ar/' %}
  {% set restPath = restPath | replace('/ar/', '/') %}
{% elseif restPath | slice(0,3) == '/ar' %}
  {% set restPath = restPath | replace('/ar', '/') %}
{% endif %}

<!DOCTYPE html>
<html lang="{{ currentLang }}" dir="{{ currentDir }}">
<head>
  <meta charset="UTF-8" />
  <title>{% if title %}{{ title }} â€“ {% endif %}Thesis Investigation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<body class="lang-{{ currentLang }}">
  {% set t = translations[currentLang] %}

  <header id="header" class="main-nav">
    <div class="nav-inner">
      <a class="nav-logo" href="/{{ currentLang }}/">HOME</a>

      <nav id="nav" class="nav-main" aria-label="Primary">
        <ul class="menu">
          
          <!-- ARCHIVE -->
          <li class="menu-item has-submenu">
            <a class="menu-toplink" href="/{{ currentLang }}/cases/dias/">Archive</a>
            <ul class="submenu" aria-label="Archive submenu">
              <li><a href="/{{ currentLang }}/documents/">Documents &amp; data</a></li>
              <li><a href="/{{ currentLang }}/publications/">Curriculum</a></li>
            </ul>
          </li>

          <!-- INVESTIGATION -->
          <li class="menu-item has-submenu">
            <a class="menu-toplink" href="/{{ currentLang }}/about/">Investigation</a>
            <ul class="submenu" aria-label="About submenu">
              {# <li><a href="/{{ currentLang }}/about/#what-we-document">What we document</a></li> #}
              {#<li><a href="/{{ currentLang }}/methodology/">Investigating DIAS: A Manual</a></li>#}
              <li><a href="/{{ currentLang }}/timeline/">Timeline</a></li>
              <li><a href="/{{ currentLang }}/figures-stats/">Figures &amp; Statistics</a></li>
            </ul>
          </li>

          <!-- MANUAL -->
          <li class="menu-item has-submenu">
            <a class="menu-toplink" href="/{{ currentLang }}/manual/">Manual</a>
          </li>

        </ul>

        <div class="nav-right">
          <div class="nav-lang" aria-label="Language">
            <a href="/en{{ restPath }}" class="nav-lang__link{% if currentLang == 'en' %} nav-lang__link--active{% endif %}">
              {{ translations.en.lang_en }}
            </a>
            <a href="/de{{ restPath }}" class="nav-lang__link{% if currentLang == 'de' %} nav-lang__link--active{% endif %}">
              {{ translations.de.lang_de }}
            </a>
            <a href="/ar{{ restPath }}" class="nav-lang__link{% if currentLang == 'ar' %} nav-lang__link--active{% endif %}">
              {{ translations.ar.lang_ar }}
            </a>
          </div>
        </div>
      </nav>

      <button class="hamburger" type="button" aria-label="Menu">
        <span class="hamburger-box"><span class="hamburger-inner"></span></span>
      </button>
    </div>
  </header>

<main class="site-main justify-text">
  {{ content | safe }}
</main>


  <footer class="site-footer">
    <p>Archival platform for my Master's thesis. Built with Eleventy &amp; vanilla JS.</p>
  </footer>

  <script src="/assets/scripts/main.js"></script>
</body>
</html>
